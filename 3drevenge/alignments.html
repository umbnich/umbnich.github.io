<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>3DRevenge - Alignments</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: row;
      justify-content: center;
      gap: 40px;
      padding: 20px;
    }

    .grid-section {
      text-align: center;
      flex-grow: 1;
    }

    h1 {
      margin-bottom: 20px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      max-width: 600px;
      margin: auto;
    }

    .cell {
      border: 1px solid #999;
      padding-top: 70%;
      position: relative;
      background-color: #f8f8f8;
    }

    .label {
      position: absolute;
      top: 5px;
      left: 5px;
      font-size: 12px;
      color: #555;
    }

    .subgrid {
      position: absolute;
      inset: 0;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
    }

    .subcell {
      border: 0;
      position: relative;
    }

    .icon {
      position: absolute;
      font-size: 18px;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
    }

    .sidebar, .voting-panel {
      width: 250px;
      font-size: 14px;
    }

    .sidebar h2, .voting-panel h2 {
      font-size: 16px;
      margin-bottom: 10px;
    }

    .history-entry {
      margin-bottom: 10px;
    }

    .vote-box {
      margin-bottom: 20px;
      border-bottom: 1px solid #ccc;
      padding-bottom: 10px;
    }

    .vote-box select,
    .vote-box textarea {
      width: 100%;
      margin-top: 5px;
      margin-bottom: 5px;
    }

    .vote-box button {
      padding: 5px 10px;
      font-size: 13px;
      cursor: pointer;
    }
  </style>

  <script>
    const alignments = [
      "Lawful Good", "Neutral Good", "Chaotic Good",
      "Lawful Neutral", "Neutral", "Chaotic Neutral",
      "Lawful Evil", "Neutral Evil", "Chaotic Evil"
    ];

    function alignmentToCell(alignment) {
      const index = alignments.indexOf(alignment);
      if (index === -1) return null;
      const mainRow = Math.floor(index / 3);
      const mainCol = index % 3;
      return `cell-${mainRow}-${mainCol}-1-1`;
    }

    async function loadData() {
      const res = await fetch('data.json');
      const data = await res.json();
      return data.users;
    }

    function createIcon(iconChar) {
      const icon = document.createElement("div");
      icon.className = "icon";
      icon.textContent = iconChar;
      return icon;
    }

    window.onload = async function () {
      if (!sessionStorage.getItem("loggedIn") || !sessionStorage.getItem("username")) {
        alert("Accesso negato! Torna al login.");
        window.location.href = "index.html";
        return;
      }

      const currentUser = sessionStorage.getItem("username");
      const users = await loadData();

      // Posizionamento icone
      for (const user in users) {
        const alignment = users[user].position.current;
        const iconChar = users[user].icon;
        const cellId = alignmentToCell(alignment);
        if (cellId) {
          const target = document.getElementById(cellId);
          if (target) target.appendChild(createIcon(iconChar));
        }
      }

      // Colonna sinistra: movimenti
      const historyContainer = document.getElementById("history");
      for (const user in users) {
        const { icon, position } = users[user];
        const entry = document.createElement("div");
        entry.className = "history-entry";
        entry.innerText = `${icon} ${user}: ${position.previous} ‚Üí ${position.current}`;
        historyContainer.appendChild(entry);
      }

      // Colonna destra: votazione
      const votingArea = document.getElementById("voting-area");
      for (const user in users) {
        if (user === currentUser) continue;

        const icon = users[user].icon || "‚ùì";
        const container = document.createElement("div");
        container.className = "vote-box";

        const title = document.createElement("div");
        title.innerHTML = `<strong>${icon} ${user}</strong>`;
        container.appendChild(title);

        const select = document.createElement("select");
        alignments.forEach(alignment => {
          const option = document.createElement("option");
          option.value = alignment;
          option.textContent = alignment;
          select.appendChild(option);
        });
        container.appendChild(select);

        const textarea = document.createElement("textarea");
        textarea.rows = 2;
        textarea.placeholder = "Motivazione...";
        container.appendChild(textarea);

        const button = document.createElement("button");
        button.textContent = "Vota";
        button.onclick = function () {
          const voto = select.value;
          const motivo = textarea.value;
          console.log(`üó≥Ô∏è Votazione per ${user}: ${voto}`);
          console.log(`‚úèÔ∏è Motivazione: ${motivo}`);
          alert(`Hai votato per spostare ${user} a "${voto}"\\nMotivazione: ${motivo}`);
        };
        container.appendChild(button);

        votingArea.appendChild(container);
      }
    };
  </script>
</head>
<body>
  <!-- Colonna sinistra -->
  <div class="sidebar">
    <h2>Movimenti</h2>
    <div id="history"></div>
  </div>

  <!-- Centro -->
  <div class="grid-section">
    <h1>Tabella Allineamenti D&D</h1>
    <div class="grid">
      <!-- Griglia 3x3 -->
      <div class="cell"><span class="label">Lawful Good</span><div class="subgrid"><div class="subcell" id="cell-0-0-1-1"></div></div></div>
      <div class="cell"><span class="label">Neutral Good</span><div class="subgrid"><div class="subcell" id="cell-0-1-1-1"></div></div></div>
      <div class="cell"><span class="label">Chaotic Good</span><div class="subgrid"><div class="subcell" id="cell-0-2-1-1"></div></div></div>

      <div class="cell"><span class="label">Lawful Neutral</span><div class="subgrid"><div class="subcell" id="cell-1-0-1-1"></div></div></div>
      <div class="cell"><span class="label">Neutral</span><div class="subgrid"><div class="subcell" id="cell-1-1-1-1"></div></div></div>
      <div class="cell"><span class="label">Chaotic Neutral</span><div class="subgrid"><div class="subcell" id="cell-1-2-1-1"></div></div></div>

      <div class="cell"><span class="label">Lawful Evil</span><div class="subgrid"><div class="subcell" id="cell-2-0-1-1"></div></div></div>
      <div class="cell"><span class="label">Neutral Evil</span><div class="subgrid"><div class="subcell" id="cell-2-1-1-1"></div></div></div>
      <div class="cell"><span class="label">Chaotic Evil</span><div class="subgrid"><div class="subcell" id="cell-2-2-1-1"></div></div></div>
    </div>
  </div>

  <!-- Colonna destra -->
  <div class="voting-panel">
    <h2>Vota</h2>
    <div id="voting-area"></div>
  </div>
<script src="voting.js"></script>

</body>
</html>
